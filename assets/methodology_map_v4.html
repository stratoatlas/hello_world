<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Design Methodology Map v4</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,400;0,500;1,400&family=Syne:wght@400;600;700;800&family=Inter:wght@300;400;500&display=swap');
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}

  :root{
    --bg:#080b10; --bg2:#0d1117; --bg3:#131820;
    --line:rgba(255,255,255,.07); --line2:rgba(255,255,255,.04);
    --text:#e2e6ef; --text2:#7a8699;
    /* WCAG fix: was #3e4858 (~2.2:1 contrast) → now #8090a0 (~5.9:1) */
    --text3:#8090a0;
    --accent:#c0392b; --panel-w:320px;
  }

  /* ── SKIP LINK ── */
  .skip-link{
    position:absolute;top:-100%;left:8px;
    background:#fff;color:#000;
    padding:8px 16px;border-radius:0 0 4px 4px;
    font-family:'Inter',sans-serif;font-size:14px;font-weight:600;
    z-index:9999;text-decoration:none;
    transition:top .1s;
  }
  .skip-link:focus{top:0;}

  /* ── FOCUS STYLES (WCAG 2.4.7 / 2.4.11) ── */
  :focus-visible{
    outline:2px solid #6ab0ff;
    outline-offset:2px;
    border-radius:2px;
  }

  body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}

  /* ── LAYOUT ── */
  .app{display:flex;flex-direction:column;min-height:100vh;}
  .main-area{display:flex;flex:1;overflow:hidden;}
  .map-area{flex:1;overflow-y:auto;min-width:0;}

  /* ── HEADER ── */
  header{
    padding:24px 40px 18px;border-bottom:1px solid var(--line);
    display:flex;align-items:flex-start;justify-content:space-between;gap:24px;
    flex-shrink:0;
  }
  .header-left h1{font-family:'Syne',sans-serif;font-size:19px;font-weight:800;letter-spacing:-.4px;color:#fff;}
  .header-left p{margin-top:3px;font-family:'DM Mono',monospace;font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:1.2px;}
  .legend{display:flex;flex-wrap:wrap;gap:5px 12px;max-width:460px;}

  /* legend items → button elements for keyboard access */
  .legend-item{
    display:inline-flex;align-items:center;gap:5px;
    font-size:11px;color:var(--text2);
    cursor:pointer;transition:color .15s;user-select:none;
    position:relative;
    background:transparent;border:none;padding:2px 0;
    font-family:'Inter',sans-serif;
  }
  .legend-item:hover,.legend-item:focus-visible{color:var(--text);outline-offset:3px;}
  .legend-item[aria-pressed="false"]{opacity:.2;}
  /* Tooltip on hover AND focus */
  .legend-item:hover .legend-tip,
  .legend-item:focus .legend-tip{opacity:1;pointer-events:none;}
  .legend-tip{
    position:absolute;top:calc(100% + 9px);left:0;
    background:#161e2c;border:1px solid rgba(255,255,255,.1);
    border-radius:4px;padding:10px 13px;width:220px;
    font-size:11px;color:var(--text2);line-height:1.55;
    opacity:0;transition:opacity .15s;pointer-events:none;
    box-shadow:0 8px 28px rgba(0,0,0,.65);z-index:300;
    font-family:'Inter',sans-serif;white-space:normal;
  }
  .legend-tip b{display:block;margin-bottom:4px;font-family:'Syne',sans-serif;font-size:12px;color:#fff;font-weight:700;}
  .legend-tip::before{content:'';position:absolute;bottom:100%;left:10px;border:5px solid transparent;border-bottom-color:#161e2c;}
  .legend-dot{width:8px;height:8px;border-radius:2px;flex-shrink:0;}
  .legend-dot.pf{background:transparent!important;border:1.5px dashed #4a5568;}

  /* ── FILTER BAR ── */
  .filter-bar{
    padding:10px 40px;display:flex;align-items:center;gap:8px;
    border-bottom:1px solid var(--line2);flex-shrink:0;
    background:var(--bg);
  }
  .filter-label{font-family:'DM Mono',monospace;font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-right:4px;}
  .filter-btn{
    font-family:'DM Mono',monospace;font-size:10px;
    padding:3px 9px;border-radius:2px;border:1px solid var(--line);
    background:transparent;color:var(--text3);
    cursor:pointer;transition:all .15s;text-transform:uppercase;letter-spacing:.5px;
  }
  .filter-btn:hover,
  .filter-btn[aria-pressed="true"]{background:var(--bg3);color:var(--text);border-color:rgba(255,255,255,.15);}
  .meta-legend{margin-left:auto;display:flex;align-items:center;gap:6px;font-family:'DM Mono',monospace;font-size:10px;color:var(--text3);}
  .meta-icon-sample{font-size:9px;color:#3a4a7e;opacity:.8;}

  /* ── MAP ── */
  .map-wrapper{padding:20px 32px 20px 8px;display:flex;gap:0;}
  .y-label{writing-mode:vertical-rl;transform:rotate(180deg);font-family:'DM Mono',monospace;font-size:10px;color:var(--text3);letter-spacing:2px;text-transform:uppercase;padding:0 8px;display:flex;align-items:center;flex-shrink:0;}
  .map-inner{flex:1;display:flex;flex-direction:column;}
  .x-axis{display:grid;grid-template-columns:120px 1fr 1fr 1fr 1fr;margin-bottom:3px;}
  .x-axis-cell{font-family:'DM Mono',monospace;font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;text-align:center;padding:0 4px 8px;}
  .x-axis-cell span{display:block;font-size:9px;color:var(--text3);opacity:.6;margin-top:2px;font-style:italic;}

  /* ── GRID ── */
  .grid{display:grid;grid-template-columns:120px 1fr 1fr 1fr 1fr;border:1px solid var(--line);border-radius:4px;overflow:visible;position:relative;}
  .row-label{padding:9px 12px 9px 0;font-family:'DM Mono',monospace;font-size:10px;color:var(--text2);text-transform:uppercase;letter-spacing:.4px;display:flex;align-items:center;border-right:1px solid var(--line);border-bottom:1px solid var(--line2);text-align:right;justify-content:flex-end;line-height:1.3;}
  .row-label.arch-row{color:rgba(222,100,90,.85);}
  .row-label:last-child{border-bottom:none;}
  .cell{border-right:1px solid var(--line2);border-bottom:1px solid var(--line2);padding:7px 6px;min-height:78px;display:flex;flex-wrap:wrap;gap:3px;align-content:flex-start;position:relative;}
  .cell.last-col{border-right:none;}
  .cell.last-row{border-bottom:none;}
  .cell.arch-row-cell{background:rgba(192,57,43,.025);border-bottom:1px solid rgba(192,57,43,.1);}
  .cell.arch-row-cell.last-row{border-bottom:none;}
  .cell.cdpa-zone{background:rgba(192,57,43,.04);}
  .cell.cdpa-zone::after{content:'';position:absolute;inset:0;border:1px solid rgba(192,57,43,.18);pointer-events:none;}
  .gap-label{font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase;letter-spacing:.8px;position:absolute;bottom:4px;right:6px;pointer-events:none;display:flex;align-items:center;gap:3px;}
  .gap-structural .gap-dot{background:rgba(100,120,160,.35);width:5px;height:5px;border-radius:50%;flex-shrink:0;}
  .gap-structural .gap-text{color:rgba(160,180,210,.7);}
  .gap-historical .gap-dot{background:rgba(192,57,43,.5);width:5px;height:5px;border-radius:50%;flex-shrink:0;}
  .gap-historical .gap-text{color:rgba(220,100,80,.75);}
  .gap-outofscope .gap-dot{background:rgba(100,140,80,.5);width:5px;height:5px;border-radius:50%;flex-shrink:0;}
  .gap-outofscope .gap-text{color:rgba(140,190,100,.7);}
  .cell.void-structural{background:rgba(255,255,255,.008);}
  .cell.void-historical{background:rgba(192,57,43,.035);}
  .cell.void-outofscope{background:rgba(80,110,50,.02);}

  /* void legend in filter bar */
  .void-legend{display:flex;align-items:center;gap:16px;margin-left:auto;}

  /* void items → button elements for keyboard tooltip access */
  .void-item{
    display:inline-flex;align-items:center;gap:5px;
    font-family:'DM Mono',monospace;font-size:10px;color:var(--text3);
    position:relative;cursor:default;padding:2px 0;
    background:transparent;border:none;
    font-family:'DM Mono',monospace;
  }
  .void-item:hover .void-tip,
  .void-item:focus .void-tip{opacity:1;}
  .void-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
  .void-dot.s{background:rgba(100,120,160,.5);}
  .void-dot.h{background:rgba(192,57,43,.6);}
  .void-dot.o{background:rgba(100,140,80,.5);}
  .void-item span{border-bottom:1px dashed rgba(255,255,255,.1);}
  .void-tip{
    position:absolute;bottom:calc(100% + 10px);right:0;
    background:#161e2c;border:1px solid rgba(255,255,255,.1);
    border-radius:4px;padding:11px 13px;width:230px;
    font-size:11px;color:var(--text2);
    line-height:1.55;opacity:0;transition:opacity .15s;pointer-events:none;
    box-shadow:0 8px 28px rgba(0,0,0,.65);z-index:200;
    font-family:'Inter',sans-serif;
  }
  .void-tip b{display:block;margin-bottom:5px;font-family:'Syne',sans-serif;font-size:12px;color:#fff;font-weight:700;}
  .void-tip::after{content:'';position:absolute;top:100%;right:12px;border:5px solid transparent;border-top-color:#161e2c;}

  /* ── CHIPS (now button elements) ── */
  .chip{
    display:inline-flex;align-items:center;gap:4px;
    padding:3px 7px;border-radius:3px;
    font-size:10px;font-weight:500;
    cursor:pointer;transition:all .15s;
    line-height:1.3;user-select:none;position:relative;
    /* button reset */
    font-family:'Inter',sans-serif;border-style:solid;
  }
  .chip:hover{transform:translateY(-1px);filter:brightness(1.3);z-index:10;}
  .chip:focus-visible{transform:translateY(-1px);z-index:10;outline:2px solid #6ab0ff;outline-offset:2px;}
  .chip[aria-pressed="true"]{transform:translateY(-1px);filter:brightness(1.4);z-index:10;outline:1px solid rgba(255,255,255,.25);outline-offset:1px;}
  .chip[aria-disabled="true"]{opacity:.08;pointer-events:none;}
  .chip.pf-chip{background:transparent!important;border-style:dashed!important;font-style:italic;}
  .chip.star{font-weight:700;box-shadow:0 0 10px rgba(192,57,43,.35);}
  .meta-marker{font-size:8px;opacity:.7;flex-shrink:0;}

  /* ── SIDE PANEL ── */
  .panel{
    width:0;flex-shrink:0;overflow:hidden;
    border-left:1px solid var(--line);
    background:var(--bg2);
    transition:width .25s cubic-bezier(.4,0,.2,1);
    display:flex;flex-direction:column;
  }
  .panel.open{width:var(--panel-w);}
  .panel-inner{width:var(--panel-w);padding:20px 20px;overflow-y:auto;flex:1;}

  .panel-close{
    position:absolute;top:12px;right:12px;
    width:24px;height:24px;border:1px solid var(--line);border-radius:2px;
    background:transparent;color:var(--text2);cursor:pointer;
    display:flex;align-items:center;justify-content:center;
    font-size:14px;line-height:1;transition:all .15s;
  }
  .panel-close:hover{border-color:rgba(255,255,255,.2);color:var(--text);}

  .panel-header{position:relative;padding-bottom:14px;border-bottom:1px solid var(--line);margin-bottom:16px;}
  .panel-group-tag{
    font-family:'DM Mono',monospace;font-size:9px;text-transform:uppercase;
    letter-spacing:1px;margin-bottom:6px;
  }
  .panel-name{font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:#fff;line-height:1.2;margin-bottom:6px;}
  .panel-chips{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px;}

  /* WCAG: panel chip colors with sufficient contrast on --bg2 (#0d1117) */
  .panel-chip{font-family:'DM Mono',monospace;font-size:9px;padding:2px 6px;border-radius:2px;border:1px solid var(--line);color:var(--text2);text-transform:uppercase;}
  /* cdpa: was rgba(192,57,43,.8) → ~2.8:1 FAIL; now #e06050 → ~5.8:1 PASS */
  .panel-chip.cdpa{color:#e06050;border-color:rgba(224,96,80,.35);}
  /* pf: was #4a6080 → ~3.3:1 FAIL; now #7a90b0 → ~6.3:1 PASS */
  .panel-chip.pf{color:#7a90b0;border-color:rgba(122,144,176,.3);}
  /* meta: was #3a5a9e → ~2.7:1 FAIL; now #6a8fce → ~6.4:1 PASS */
  .panel-chip.meta{color:#6a8fce;border-color:rgba(106,143,206,.3);}

  .panel-section{margin-bottom:16px;}
  .panel-section-label{
    font-family:'DM Mono',monospace;font-size:9px;color:var(--text3);
    text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;
    display:flex;align-items:center;gap:6px;
  }
  .panel-section-label::after{content:'';flex:1;height:1px;background:var(--line2);}
  .panel-section-content{font-size:11px;color:var(--text2);line-height:1.6;}
  .panel-section-content.highlight{
    color:var(--text);font-size:11px;
    padding:8px 10px;background:var(--bg3);border-radius:3px;
    border-left:2px solid;
  }
  .panel-list{list-style:none;padding:0;}
  .panel-list li{
    font-size:11px;color:var(--text2);line-height:1.5;
    padding:4px 0;border-bottom:1px solid var(--line2);
    display:flex;gap:8px;
  }
  .panel-list li:last-child{border-bottom:none;}
  .panel-list li::before{content:'–';color:var(--text3);flex-shrink:0;}
  .panel-empty{font-family:'DM Mono',monospace;font-size:10px;color:var(--text3);font-style:italic;}

  /* ── CALLOUT ── */
  .callout{margin:14px 0 0 120px;display:flex;align-items:flex-start;gap:10px;padding:10px 14px;border:1px solid rgba(192,57,43,.22);border-radius:3px;background:rgba(192,57,43,.04);max-width:660px;}
  .callout-bar{width:3px;min-height:100%;background:rgba(192,57,43,.45);border-radius:2px;flex-shrink:0;align-self:stretch;}
  .callout p{font-size:11px;color:var(--text2);line-height:1.55;}
  .callout strong{color:#e07060;}
  .pf-note{margin:8px 0 0 120px;display:flex;align-items:center;gap:7px;font-family:'DM Mono',monospace;font-size:10px;color:var(--text3);max-width:500px;}
  .pf-swatch{display:inline-block;width:18px;height:9px;border:1.5px dashed #4a5568;border-radius:2px;flex-shrink:0;}
</style>
</head>
<body>

<!-- Skip navigation for keyboard users -->
<a class="skip-link" href="#map-grid">Skip to methodology map</a>

<div class="app">

<header>
  <div class="header-left">
    <h1>Design Methodology Map <span style="color:var(--text3);font-weight:400;font-size:13px" aria-label="version 3">v3</span></h1>
    <p>44 methodologies · 7 levels · 4 action axes · decision support</p>
  </div>
  <nav aria-label="Filter by group">
    <div class="legend" id="legend" role="group" aria-label="Toggle methodology groups"></div>
  </nav>
</header>

<div class="filter-bar" role="toolbar" aria-label="Filter methodologies">
  <span class="filter-label" id="filter-label">Show:</span>
  <button class="filter-btn" data-filter="all" aria-pressed="true" aria-describedby="filter-label">All</button>
  <button class="filter-btn" data-filter="nopf" aria-pressed="false" aria-describedby="filter-label">Exclude frameworks</button>
  <button class="filter-btn" data-filter="cdpa" aria-pressed="false" aria-describedby="filter-label">CDPA zone</button>
  <button class="filter-btn" data-filter="gap" aria-pressed="false" aria-describedby="filter-label">Gaps</button>
  <div aria-hidden="true" style="width:1px;height:16px;background:var(--line);margin:0 4px;"></div>
  <div class="void-legend" role="group" aria-label="Empty cell types legend">
    <button class="void-item" type="button">
      <div class="void-dot s" aria-hidden="true"></div>
      <span>structural</span>
      <div class="void-tip" role="tooltip"><b>Structural void</b>The combination does not make sense as a class of activity. For example, "conflict resolution" at the perception level — there are no architectural contradictions there. A normal cognitive vacuum.</div>
    </button>
    <button class="void-item" type="button">
      <div class="void-dot h" aria-hidden="true"></div>
      <span>historical gap</span>
      <div class="void-tip" role="tooltip"><b>Historical gap</b>Methodologies should exist, but the industry has not created them. This is the zone of lowest methodological density — and a real opportunity for new tools, including CDPA.</div>
    </button>
    <button class="void-item" type="button">
      <div class="void-dot o" aria-hidden="true"></div>
      <span>out of scope</span>
      <div class="void-tip" role="tooltip"><b>Out of design scope</b>Methods exist, but in adjacent disciplines — organizational design, systems engineering, business analysis. Not yet integrated into product design.</div>
    </button>
    <div aria-hidden="true" style="width:1px;height:16px;background:var(--line);margin:0 4px;"></div>
    <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--text3);" aria-label="Diamond symbol indicates meta-method"><span aria-hidden="true">◆</span> meta-method</span>
  </div>
</div>

<div class="main-area">
  <div class="map-area" id="map-area">
    <div class="map-wrapper">
      <div class="y-label" aria-hidden="true">System Level</div>
      <div class="map-inner">
        <div class="x-axis" role="row" aria-label="Action axes">
          <div aria-hidden="true"></div>
          <div class="x-axis-cell" role="columnheader">Diagnosis<span>understand the situation</span></div>
          <div class="x-axis-cell" role="columnheader">Generation<span>create options</span></div>
          <div class="x-axis-cell" role="columnheader">Resolution<span>resolve the conflict</span></div>
          <div class="x-axis-cell" role="columnheader">Optimisation<span>improve the system</span></div>
        </div>
        <div class="grid" id="map-grid" role="grid" aria-label="Methodology map: system levels vs action axes" tabindex="0"></div>
        <div class="callout" role="note" aria-label="CDPA zone note">
          <div class="callout-bar" aria-hidden="true"></div>
          <p><strong>CDPA zone</strong> — lowest methodological density. Contradiction resolution at the Architecture / Interface / Workflow levels is covered only by TRIZ (not adapted for digital products) and partially by CDPA. <strong>Confirmed gap.</strong></p>
        </div>
        <div class="pf-note" aria-label="Process framework indicator explanation">
          <span class="pf-swatch" aria-hidden="true"></span>
          <span>Dashed border — process frameworks: describe the workflow, do not provide a resolution mechanism</span>
        </div>
      </div>
    </div>
  </div>

  <!-- SIDE PANEL -->
  <div
    class="panel"
    id="panel"
    role="dialog"
    aria-modal="true"
    aria-labelledby="p-name"
    aria-hidden="true"
  >
    <div class="panel-inner" id="panel-inner">
      <div class="panel-header" id="panel-header">
        <button class="panel-close" id="panel-close" aria-label="Close method detail panel">
          <span aria-hidden="true">✕</span>
        </button>
        <div class="panel-group-tag" id="p-group"></div>
        <div class="panel-name" id="p-name"></div>
        <div class="panel-chips" id="p-chips" aria-label="Method attributes"></div>
      </div>
      <div id="p-body" aria-live="polite" aria-atomic="true"></div>
    </div>
  </div>
</div>

</div><!-- .app -->

<script>
// ── DATA ────────────────────────────────────────────────────────────────────

const GROUPS = [
  {id:0, label:"Process Frameworks", color:"#4a5568", pf:true,
   tip:"Describe the workflow and phases, but do not provide a resolution mechanism. Useful for process management, not for solving the task. Example: Double Diamond explains when to diverge — but not how to resolve."},
  {id:1, label:"Discovery / Framing", color:"#2d6a4f",
   tip:"Extract the right problem and context before designing. Object — reality: work practices, mental models, scenarios. Output — an 'as is' map, not a solution."},
  {id:2, label:"Value & Strategy", color:"#1d4e89",
   tip:"Determine what the value is, for whom, and how to choose directions. Object — value model, market, outcomes. Answers 'what to build and why' — before 'how'."},
  {id:3, label:"Behaviour", color:"#7a4fa8",
   tip:"Explain and design user behaviour change. Object — motivation, triggers, barriers, habits. Operate at User Perception and Behaviour levels — not architecture."},
  {id:4, label:"Synthesis / Resolution", color:"#c0392b",
   tip:"Create a solution and resolve systemic conflict. A rare zone — most methods here are either engineering (TRIZ) or not adapted for the product. This is exactly where CDPA is located."},
  {id:5, label:"Delivery / Improvement", color:"#c97b1a",
   tip:"Ensure stable production of results and continuous improvement. Object — flow, process, waste elimination. Kaizen, Lean. Not about 'what to do' — about 'how to do it sustainably'."},
  {id:6, label:"Quality / Errors", color:"#1a7a6e",
   tip:"Reduce defects, prevent errors, control quality. Object — failure points, usability issues. Work diagnostically (audits) or constructively (Poka-Yoke)."},
  {id:7, label:"Perception / Aesthetics", color:"#8a5225",
   tip:"Manage perception, cognitive load, and aesthetic frame. Object — how the brain perceives form. Gestalt, Ma, Wabi-Sabi. Not solution methods — laws and principles."},
  {id:8, label:"Complexity Navigation", color:"#3a4a7e",
   tip:"Help choose the right approach depending on the type of situation. Do not change the system themselves — navigate to the right method. Marked ◆. Cynefin, Wardley, Three Horizons."},
];

const ROWS = [
  {label:"User Perception", arch:false},
  {label:"Behaviour",        arch:false},
  {label:"Interface",        arch:false},
  {label:"Workflow",         arch:false},
  {label:"Organisation",     arch:false},
  {label:"Value Model",      arch:false},
  {label:"Architecture\n& Trade-offs", arch:true},
];

// col: 0=Diagnosis, 1=Generation, 2=Resolution, 3=Optimisation
// row: 0=UserPerception … 6=Architecture
const METHODS = [
  // ── PROCESS FRAMEWORKS ──
  {name:"Design Thinking",       g:0,col:0,row:1,pf:true,
   desc:"Process framework: empathy → ideas → prototypes. Describes movement, does not provide a resolution mechanism. Often mistakenly perceived as a design method.",
   mechanism:"Empathize → Define → Ideate → Prototype → Test",
   when:"Start of a project when the problem is not yet formulated. A direction is needed.",
   whenNot:"When the problem is known. When a mechanism is needed, not a process.",
   uncertainty:"Problem-related",
   output:"Insights about pains, directions for ideas, hypothesis prototypes",
   limits:"Does not resolve contradictions. Result depends on quality of empathy and facilitation.",
   tags:["process","empathy","ideo"]},

  {name:"HCD",                   g:0,col:0,row:1,pf:true,
   desc:"Human-Centered Design. Extended DT with focus on social, cultural, and physical life context of the person.",
   mechanism:"Inspiration → Ideation → Implementation (with constant return to the human)",
   when:"When broad life context matters. Social and humanitarian products.",
   whenNot:"When the social aspect is secondary. Technical B2B systems.",
   uncertainty:"Contextual",
   output:"Picture of user's life, hidden needs, humanistically grounded solutions",
   limits:"Methodologically close to DT. Difficult to separate in practice.",
   tags:["process","context","ideo"]},

  {name:"Double Diamond",        g:0,col:0,row:2,pf:true,
   desc:"Divergence → convergence in two diamonds: first the right problem, then the right solution.",
   mechanism:"Discover → Define → Develop → Deliver",
   when:"Structuring chaos in a team. Explaining the process to stakeholders.",
   whenNot:"When a specific resolution mechanism is needed. Does not provide tools within phases.",
   uncertainty:"Problem-related / process",
   output:"Clear understanding of which phase the team is in and where it gets stuck",
   limits:"Only a frame. What to do inside each diamond is not explained.",
   tags:["process","framework","UK Design Council"]},

  {name:"Lean UX (cycle)",        g:0,col:0,row:2,pf:true,
   desc:"Iterative cycle: hypothesis → minimal experiment → learning. A process framework for product teams.",
   mechanism:"Think → Make → Check (continuously)",
   when:"Agile teams. Startups. When speed of learning is needed.",
   whenNot:"Regulated industries. When documentation is required. Enterprise with strict requirements.",
   uncertainty:"Process",
   output:"Verified hypothesis, updated understanding, next experiment",
   limits:"Easy to lose strategy behind tactics. Technical debt accumulates.",
   tags:["process","lean","agile"]},

  {name:"Design Sprint",         g:0,col:1,row:2,pf:true,
   desc:"5-day intensive to test one critical hypothesis. A time-box framework, not a resolution method.",
   mechanism:"Mon: map+question → Tue: ideas → Wed: decision → Thu: prototype → Fri: test",
   when:"Start of a new product. Stuck decisions. The team needs focus.",
   whenNot:"Operational improvements. No access to users within 5 days.",
   uncertainty:"Problem-related / time",
   output:"Answer to the key question + reactions from 5 real users",
   limits:"Rigid structure. Superficial for complex problems. Everyone must be present all week.",
   tags:["sprint","5-days","google ventures"]},

  {name:"Shape Up",              g:0,col:3,row:3,pf:true,
   desc:"6-week cycles with flexible scope. Pitch → bet → autonomous development → delivery.",
   mechanism:"Pitch → bet on cycle → autonomous development → delivery → cool-down",
   when:"Teams with accumulated backlog. When real autonomy is needed.",
   whenNot:"Frequent releases needed. Enterprise with tight deadlines. Immature teams.",
   uncertainty:"Process",
   output:"Shipped increment in 6 weeks; pitches for the next cycle",
   limits:"Created for Basecamp. Hard to scale. Requires mature PMs.",
   tags:["process","basecamp","37signals"]},

  // ── DISCOVERY / FRAMING ──
  {name:"Contextual Design",     g:1,col:0,row:3,
   desc:"Full research methodology: field observation → work models → design vision. Alternative to DT in enterprise.",
   mechanism:"Contextual inquiry → interpretation → work models (flow/sequence/artifact/cultural/physical) → affinity diagram → design vision",
   when:"Enterprise, B2B. When the usage context is complex and insufficiently understood.",
   whenNot:"Consumer products with simple context. Startups. Short projects.",
   uncertainty:"Contextual",
   output:"Work models + affinity diagram + design vision + system prototype",
   limits:"Labour-intensive (weeks of fieldwork). Expensive. Requires experienced team.",
   tags:["field research","work models","holtzblatt"]},

  {name:"Mental Models",         g:1,col:0,row:1,
   desc:"Building user mental models through deep interviews. Not tied to the current product.",
   mechanism:"Interviews → coding → grouping by thinking tasks → diagram → gap analysis with product",
   when:"Long-term strategic research. Product rethinking.",
   whenNot:"Short projects. Tactical UI tasks.",
   uncertainty:"Cognitive / contextual",
   output:"Mental model diagram + product alignment",
   limits:"Very labour-intensive. Hard to sell to stakeholders. Doesn't provide solutions — only understanding.",
   tags:["mental model","interview","indi young"]},

  {name:"Scenario-Based Design", g:1,col:0,row:2,
   desc:"Narrative scenarios: who, in what situation, what hinders, what success looks like. Designing in context.",
   mechanism:"Actors → problem scenarios → activity scenarios → design scenarios → validation",
   when:"Designing new systems. Team education. Stakeholder presentations.",
   whenNot:"Open platforms with unpredictable scenarios. Very simple interfaces.",
   uncertainty:"Contextual",
   output:"Set of scenarios + solutions verified through them",
   limits:"Scenarios can be invented without research. Easy to idealise the user.",
   tags:["scenario","narrative","carroll"]},

  {name:"Genchi Genbutsu",       g:1,col:0,row:3,
   desc:"Go and see for yourself on site. Toyota. Direct observation as the basis of any decision.",
   mechanism:"Go to the place (gemba) → observe without bias → record facts → decide",
   when:"Always before making a decision about a process or product. Audits.",
   whenNot:"When direct physical access is impossible.",
   uncertainty:"Contextual",
   output:"Direct observations + verified understanding of the situation",
   limits:"Not a method — a principle. Other tools are needed for analysis and resolution.",
   tags:["observation","toyota","lean"]},

  {name:"Goal-Directed Design",  g:1,col:0,row:1,
   desc:"Designing for real user goals (not tasks) through behavioural personas.",
   mechanism:"Research → behavioural personas → usage scenarios → interface requirements",
   when:"Complex multi-functional product. Different goals for different users. Enterprise UX.",
   whenNot:"Simple products. No resources for field research.",
   uncertainty:"Contextual / goal-related",
   output:"Behavioural personas + scenarios + interface requirements",
   limits:"Personas without real research are useless. Quickly become outdated.",
   tags:["personas","goals","alan cooper"]},

  {name:"Participatory Design",  g:1,col:1,row:3,
   desc:"Users as co-authors, not informants. Scandinavian co-design school.",
   mechanism:"Recruit as partners → joint sessions → prototyping together → joint evaluation",
   when:"Corporate internal products. Public sector. Education. High user resistance.",
   whenNot:"B2C scale. Very heterogeneous users. Tight deadlines.",
   uncertainty:"Contextual / values-based",
   output:"Jointly created concepts + high product acceptance",
   limits:"Slow. Users don't always know what they want. Hard to scale.",
   tags:["co-design","participatory","scandinavia"]},

  {name:"Activity Theory",       g:1,col:0,row:3,
   desc:"Soviet activity theory adapted for HCI. Unit of analysis — activity (motive+goals+operations), not task.",
   mechanism:"Define activity → decompose into goals and operations → identify tools and contradictions → redesign",
   when:"Complex work systems. Enterprise. Medicine. Aviation.",
   whenNot:"Simple consumer products. No access to work context.",
   uncertainty:"Systemic / activity-based",
   output:"Activity map + systemic contradictions + recommendations",
   limits:"Academically complex. Few practitioners. Hard to justify to clients.",
   tags:["activity","HCI","vygotsky","leontiev"]},

  {name:"Service Design",        g:1,col:0,row:3,
   desc:"Service design across all touchpoints: frontstage + backstage. Systemic view.",
   mechanism:"Ecosystem map → customer journey → identify pain points → redesign front and backstage",
   when:"Complex services: banking, insurance, healthcare, public services.",
   whenNot:"Simple digital products without a physical channel.",
   uncertainty:"Systemic / contextual",
   output:"Service blueprint + customer journey map + redesigned system",
   limits:"Long. Requires cross-functional access and engagement of the entire organisation.",
   tags:["service","blueprint","birgit mager"]},

  {name:"Inclusive Design",      g:1,col:0,row:0,
   desc:"Extreme users as a source of insights for everyone. Diversity → better design.",
   mechanism:"Identify excluded users → understand limitations → find solution → verify it's better for all",
   when:"Public products. Public services. When the product loses users due to barriers.",
   whenNot:"Niche B2B with a homogeneous audience.",
   uncertainty:"Contextual / functional",
   output:"Inclusive solution + expanded audience + more robust design",
   limits:"Requires additional research of extreme users. Often remains a declaration.",
   tags:["inclusion","access","microsoft","ronald mace"]},

  // ── VALUE & STRATEGY ──
  {name:"JTBD",                  g:2,col:0,row:5,
   desc:"People 'hire' a product to do a job — functional, social, or emotional. Understand the switching motive.",
   mechanism:"Capture the switching moment → understand the 'job' → identify competing alternatives → rework the solution",
   when:"When it's unclear why users choose or don't choose the product.",
   whenNot:"When the product is in active development with fixed features.",
   uncertainty:"Value-based",
   output:"Clearly formulated Job + understanding of the real competitive landscape",
   limits:"Ignores emotional nuances. Weak for identifying fundamentally new Jobs.",
   tags:["motivation","switching","christensen"]},

  {name:"ODI",                   g:2,col:0,row:5,
   desc:"Outcome-Driven Innovation. Users define desired outcomes; find uncovered ones through opportunity score.",
   mechanism:"Identify all outcomes → survey by importance and satisfaction → calculate opportunity score → design for uncovered ones",
   when:"Objective search for innovation direction. B2B and complex products.",
   whenNot:"No resources for large-scale survey. Consumer markets with emotional decisions.",
   uncertainty:"Value-based / functional",
   output:"Opportunity map + prioritised uncovered outcomes + strategy",
   limits:"Labour-intensive. Expensive. Difficult for fundamentally new products.",
   tags:["outcomes","quantitative","ulwick"]},

  {name:"Kano Model",            g:2,col:0,row:5,
   desc:"Feature classification: must-be / performance / delighters / indifferent / reverse. What is mandatory, what delights.",
   mechanism:"List attributes → Kano survey (functional+dysfunctional) → matrix → priorities",
   when:"Roadmap prioritisation. Feature evaluation. When there are many ideas and focus is needed.",
   whenNot:"Radical innovations. Early startups without a product.",
   uncertainty:"Value-based",
   output:"Kano matrix + prioritised roadmap",
   limits:"Categories change over time (delighter → must-be). Depends on sample.",
   tags:["prioritisation","satisfaction","kano","japan"]},

  {name:"Value Prop. Canvas",    g:2,col:0,row:5,
   desc:"Jobs/Pains/Gains of customer vs Pain Relievers/Gain Creators of product. Find real product–market fit.",
   mechanism:"Describe Jobs/Pains/Gains → formulate Products/Pain Relievers/Gain Creators → find mismatches",
   when:"Developing or revising the value proposition. Preparing a pitch.",
   whenNot:"When the product is fixed and nothing can be changed.",
   uncertainty:"Value-based",
   output:"Value proposition map + identified mismatches",
   limits:"Superficial without deep research. Result depends on data quality.",
   tags:["value","fit","osterwalder"]},

  {name:"Business Model Canvas", g:2,col:1,row:5,
   desc:"9 blocks of business model on one page. Structuring and analysing the value model.",
   mechanism:"Segments → value proposition → channels → relationships → revenue → resources → activities → partners → costs",
   when:"Strategic sessions. Startups. Competitor analysis. Investor presentations.",
   whenNot:"Operational management. Detailed financial modelling.",
   uncertainty:"Value-based / business",
   output:"Completed BMC + identified gaps + hypotheses",
   limits:"Static. Superficial. Does not show dynamics and competition.",
   tags:["business model","BMC","osterwalder"]},

  {name:"Ten Types of Innovation",g:2,col:1,row:5,
   desc:"Innovation across 10 dimensions: from business configuration to consumer experience.",
   mechanism:"Audit across 10 types → compare with competitors → generate in underutilised dimensions",
   when:"Strategic sessions. Stagnating business. Seeking differentiation.",
   whenNot:"Operational tasks. Early startups.",
   uncertainty:"Strategic / value-based",
   output:"Innovation map + strategy across 10 dimensions",
   limits:"Abstract without adaptation. No built-in implementation mechanism.",
   tags:["innovation","10 types","doblin","keeley"]},

  {name:"Value-Sensitive Design", g:2,col:0,row:5,
   desc:"Ethical values embedded in product architecture from the outset. Relevant for AI products.",
   mechanism:"Conceptual value analysis → empirical research → technical analysis → integration",
   when:"AI products. Platforms with large reach. Sensitive areas: health, children, finance.",
   whenNot:"Simple utilitarian products. Early prototypes.",
   uncertainty:"Value-based / ethical",
   output:"Map of value conflicts + ethical requirements + decision audit",
   limits:"Few practitioners. Market pressure often outweighs. ROI hard to justify.",
   tags:["ethics","values","batya friedman"]},

  {name:"Ikigai",                g:2,col:0,row:5,
   desc:"Intersection: what you love / what you're good at / what you're paid for / what the world needs. Navigation of meaning and positioning.",
   mechanism:"Map passion/mission/profession/vocation → find the centre → verify for sustainability",
   when:"Product or specialist positioning. Strategic sessions.",
   whenNot:"Operational tasks. Early startups without a product.",
   uncertainty:"Value-based / meaning",
   output:"Ikigai map + positioning",
   limits:"Often applied superficially. Not a design method — a navigational tool.",
   tags:["positioning","meaning","ikigai","japan"]},

  {name:"OKR / North Star",      g:2,col:3,row:4,
   desc:"Strategic alignment: North Star — single value metric, OKR — quarterly goals. Not system optimisation — strategy alignment.",
   mechanism:"Choose North Star → decompose into OKR → align teams → track → adjust",
   when:"Scaling products. Team alignment. No clarity in priorities.",
   whenNot:"Early startups before PMF. Creative and research teams.",
   uncertainty:"Value-based / process",
   output:"OKR set + North Star Metric + aligned team",
   limits:"Goodhart's Law: a measure ceases to be a good measure once it becomes a target.",
   tags:["goals","alignment","OKR","north star","andy grove"]},

  // ── BEHAVIOUR ──
  {name:"Behavioral Design",     g:3,col:1,row:1,
   desc:"B=MAP: behaviour = motivation × ability × trigger. Design the desired user behaviour.",
   mechanism:"Choose target behaviour → check B=MAP → remove ability barriers → set trigger",
   when:"Onboarding. Habit formation. Users not converting despite interest.",
   whenNot:"When the problem is in the value proposition. Ethically questionable tasks.",
   uncertainty:"Behavioural",
   output:"Behavioural product model; trigger map; simplification recommendations",
   limits:"Borders on manipulation — requires ethical reflection.",
   tags:["behavior","trigger","fogg","stanford"]},

  {name:"Nudge Design",          g:3,col:1,row:1,
   desc:"Choice architecture: change behaviour through context, not prohibition. Behavioural economics in design.",
   mechanism:"Identify target behaviour → change default or context → preserve freedom of choice",
   when:"Financial products. Health. Public sector. When prohibition is impossible or undesirable.",
   whenNot:"When explicit instruction is needed. When the audience does not accept covert influence.",
   uncertainty:"Behavioural",
   output:"New default / choice context → measurable behaviour change",
   limits:"Borders on manipulation. Works only for certain types of decisions.",
   tags:["nudge","choice architecture","thaler","sunstein"]},

  // ── SYNTHESIS / RESOLUTION ──
  {name:"TRIZ",                  g:4,col:2,row:6,cdpa:true,
   desc:"Theory of Inventive Problem Solving. Systematic method for resolving contradictions: 40 principles, ARIZ, IFR. Developed for engineering and physical systems — no direct application to digital products exists.",
   mechanism:"Formalize technical contradiction → contradiction matrix / 40 principles → formulate IFR → verify solution",
   when:"Engineering tasks with a clear physical or technical contradiction. When all standard approaches are exhausted.",
   whenNot:"Unformalized tasks. Early discovery stages. Tasks without a clear contradiction. Digital products — without adaptation.",
   uncertainty:"Functional / systemic",
   output:"Solution without compromise + modified system + verified principle",
   limits:"High entry threshold — TRIZ expertise required. Language incompatible with product teams without translation. Weak for tasks without engineering structure.",
   tags:["contradiction","inventive","altshuller","USSR"]},

  {name:"CDPA",                  g:4,col:2,row:6,cdpa:true,star:true,
   desc:"Contradiction-Driven Product Architecture. Practical adaptation of systems and TRIZ thinking for product systems. Resolves requirement conflicts without compromising functionality — where standard UX methods are exhausted.",
   mechanism:"Identify requirement conflict → find independent variable → redesign architecture → measure effect",
   when:"B2B SaaS with accumulated systemic problems. When iterative UX fixes don't produce results. Architectural dead ends: adding features worsens the problem.",
   whenNot:"Not suitable when the conflict is in product priorities or resources, not architecture. Simple tactical UI tasks. Startups without an established system.",
   uncertainty:"Requirement conflict / architectural complexity",
   output:"Architectural solution + measurable reduction in complexity, cost, or time at the system level",
   limits:"Requires understanding the whole system — does not work with fragmented access to architecture. Expert-dependent. Currently limited reproducibility without the author.",
   tags:["product","contradiction","architecture","CDPA"]},

  {name:"Theory of Constraints", g:4,col:3,row:3,
   desc:"Find the main systemic flow constraint, concentrate resources there, eliminate, repeat. Systemic optimisation — not resolving a contradiction, but sequentially removing bottlenecks.",
   mechanism:"Find constraint → exploit to the maximum → subordinate everything else to this decision → elevate the constraint → repeat",
   when:"System produces less than it could. Need one point of focus. IT, manufacturing, product delivery.",
   whenNot:"Evenly distributed problems without a clear bottleneck. Creative and research tasks.",
   uncertainty:"Systemic / bottleneck",
   output:"Identified constraint + elimination plan + restructured flow + measurable throughput increase",
   limits:"Hard to find the real constraint — people often identify the symptom. After elimination, the next one immediately appears: the work is endless.",
   tags:["constraint","throughput","goldratt","TOC"]},

  {name:"SMD / ODG",             g:4,col:2,row:4,cdpa:true,
   desc:"Shchedrovitsky: collective mental activity. Conflict of positions → schematization → new understanding. Works with unsolvable problems — where the very formulation of the problem is part of the problem.",
   mechanism:"Divide into positions → introduce the real problem → organise conflict → schematize → reflection → new understanding → programme",
   when:"Complex inter-systemic problems. High-level strategic sessions. Reforms. When the problem is not formalized.",
   whenNot:"Simple product tasks. No time for 3–5 days. Participants not ready for intellectual conflict.",
   uncertainty:"Systemic — uncertainty of the problem formulation itself",
   output:"Thinking diagrams + collective understanding + activity programme",
   limits:"Very few qualified facilitators in the world. Requires 3–5 days. Culturally complex for Western audiences.",
   tags:["collective","systems","schedrovitsky","USSR"]},

  {name:"Morphological Analysis", g:4,col:2,row:6,cdpa:true,
   desc:"Architectural variability tool: systematic exploration of the solution space through a parameter matrix.",
   mechanism:"Identify key system parameters → build matrix → systematically explore combinations → select optimal",
   when:"Finding architectural solutions with many parameters. Generating non-standard combinations.",
   whenNot:"When system parameters are unknown. Early discovery stages.",
   uncertainty:"Functional / architectural",
   output:"Morphological matrix + set of architectural options",
   limits:"Combinatorial explosion with many parameters. Requires preliminary decomposition.",
   tags:["synthesis","matrix","zwicky","architecture"]},

  {name:"Biomimicry",            g:4,col:2,row:6,
   desc:"Analogies with natural systems. Transfer the solution principle — not the form, but the mechanism.",
   mechanism:"Translate the problem into a function → search biological database → transfer principle → adapt",
   when:"Sustainable design. Seeking non-standard solutions. Innovation sprints.",
   whenNot:"Digital interfaces (weakly applicable). When there's no time to search for analogies.",
   uncertainty:"Functional / systemic",
   output:"Natural analogue + transferred principle + design solution",
   limits:"Requires knowledge of biology. Analogies don't always transfer. Better for physical products.",
   tags:["analogy","nature","benyus"]},

  // ── DELIVERY / IMPROVEMENT ──
  {name:"Kaizen",                g:5,col:3,row:3,
   desc:"Continuous small improvements through elimination of muda. PDCA cycle. A culture, not an event.",
   mechanism:"Gemba → identify muda → PDCA cycle → standardise → next step",
   when:"Mature products and processes. When a culture of improvement is needed.",
   whenNot:"Radical innovations. Crisis situations.",
   uncertainty:"Process",
   output:"Improved process standard; eliminated waste; culture",
   limits:"Slow. Not for breakthrough changes. Requires cultural shift.",
   tags:["continuous","improvement","kaizen","toyota"]},

  {name:"Lean (Flow)",           g:5,col:3,row:3,
   desc:"Optimisation of the value creation flow. Elimination of waste (muda) in the production system.",
   mechanism:"Map value stream → identify waste → eliminate → standardise → repeat",
   when:"Manufacturing, operations, IT processes. When there is clear waste in the flow.",
   whenNot:"Creative and research tasks. Non-repeatable processes.",
   uncertainty:"Process",
   output:"Value stream map + optimised flow + eliminated waste",
   limits:"Works poorly in unpredictable environments. Requires flow data.",
   tags:["flow","waste","lean","toyota"]},

  // ── QUALITY / ERRORS ──
  {name:"Poka-Yoke",             g:6,col:2,row:2,
   desc:"Make mistakes structurally impossible. Prevention before consequences.",
   mechanism:"Find potential mistake → determine type (prevention vs detection) → build protection mechanism",
   when:"Critical interfaces: medicine, finance, aviation. Forms and transactions.",
   whenNot:"Creative tasks. When the 'wrong' path is a normal variation.",
   uncertainty:"Error risk",
   output:"Protection mechanism; eliminated failure point",
   limits:"May limit flexibility. Does not eliminate systemic design errors.",
   tags:["error-proof","constraints","shingo","toyota"]},

  {name:"Heuristic Evaluation",  g:6,col:0,row:2,
   desc:"Expert audit against Nielsen's 10 principles. Fast way to find usability issues without users.",
   mechanism:"3–5 experts → independent interface walkthrough → compare findings → prioritise",
   when:"Fast audit of existing interface. Limited budget. No user access.",
   whenNot:"Early concepts. When actual user behaviour matters.",
   uncertainty:"Functional / perceptual",
   output:"List of usability issues with severity + recommendations",
   limits:"Experts are not users. Misses contextual and cultural issues.",
   tags:["audit","heuristics","nielsen"]},

  {name:"Cognitive Walkthrough", g:6,col:0,row:2,
   desc:"Simulation of new user steps. Evaluation of interface learnability.",
   mechanism:"Select task → steps → at each: is goal clear? is action visible? is connection obvious? is feedback understandable?",
   when:"Evaluating onboarding. Interfaces for new users.",
   whenNot:"For experienced users. When speed matters, not learnability.",
   uncertainty:"Cognitive / functional",
   output:"List of cognitive breakdown points + onboarding recommendations",
   limits:"Evaluates learnability only. Slow with large number of steps.",
   tags:["cognitive","onboarding","lewis","rieman"]},

  {name:"5 Whys",                g:6,col:0,row:3,
   desc:"Iterative 'why' questions down to the root cause. Toyota. Universal for any diagnosis.",
   mechanism:"Describe problem → why? ×5 → root cause → systemic solution",
   when:"Recurring problems. Retrospectives. UX problem diagnosis.",
   whenNot:"Complex systemic problems with many variables (better: Ishikawa or TOC).",
   uncertainty:"Functional / causal",
   output:"5 Whys diagram + root cause + fix recommendation",
   limits:"People stop before the root. Different teams — different causes.",
   tags:["root cause","diagnostic","toyota"]},

  // ── PERCEPTION / AESTHETICS ──
  {name:"Gestalt Principles",    g:7,col:3,row:0,
   desc:"Laws of perception: proximity, similarity, closure, figure/ground. Foundation of visual design.",
   mechanism:"Analyse → group by meaning → apply laws → verify readability",
   when:"Always — when creating any visual interface.",
   whenNot:"No situations where inapplicable. This is basic literacy.",
   uncertainty:"Perceptual",
   output:"Visually clear and structured design",
   limits:"Describes perception, does not provide solutions for complex UX tasks.",
   tags:["perception","visual","gestalt","wertheimer"]},

  {name:"Ma (間)",               g:7,col:3,row:0,
   desc:"Negative space and pause as active design elements. Japanese aesthetics.",
   mechanism:"Determine what to remove → find balance of emptiness and presence → create rhythm",
   when:"Overloaded interfaces. Premium and minimalist design.",
   whenNot:"Interfaces with maximum density: trading, monitoring.",
   uncertainty:"Perceptual",
   output:"Design with intentional whitespace, rhythm, and pauses",
   limits:"Hard to justify to stakeholders. Subjective. Requires mature judgement.",
   tags:["space","rhythm","ma","japan","kenya hara"]},

  {name:"Wabi-Sabi",             g:7,col:3,row:0,
   desc:"Beauty of imperfection, incompleteness, and transience. Authenticity over sterile polish.",
   mechanism:"Rethink 'defects' as value → remove excess finishing → leave traces of the process",
   when:"Brand design. Products with emotional connection. Counterpoint to 'plastic' perfection.",
   whenNot:"Technical B2B interfaces. Products where precision is critical.",
   uncertainty:"Emotional / values-based",
   output:"Design with emphasis on authenticity and warm imperfection",
   limits:"Hard to operationalise. Easily becomes an excuse for carelessness.",
   tags:["aesthetics","authentic","wabi-sabi","japan"]},

  // ── COMPLEXITY NAVIGATION ── meta:true ──
  {name:"Cynefin",               g:8,col:0,row:4,meta:true,
   desc:"Sensemaking framework: classifies the situation by complexity type and points to the appropriate approach. Does not change the system — helps choose the method. Main value: prevents applying the right tool to the wrong problem.",
   mechanism:"Assess situation → domain: Simple (best practice) / Complicated (expertise) / Complex (experiment) / Chaotic (act) → choose approach",
   when:"Before choosing a method in a complex context. Crisis situations. Multi-component projects with unclear problem type.",
   whenNot:"Simple operational tasks. When methodology is already defined and situation type is obvious.",
   uncertainty:"Systemic — classifies the type of uncertainty",
   output:"Situation classification + justified approach choice + prevented application errors",
   limits:"Boundaries between domains are blurry. Classification is subjective. Does not provide solutions — only navigation to a method.",
   tags:["complexity","sense-making","snowden","IBM"]},

  {name:"Systems Thinking",      g:8,col:0,row:4,meta:true,
   desc:"Feedback loops, leverage points. Understand the system before intervening. Navigates — does not change.",
   mechanism:"Describe system → causal loop diagram → reinforcing and balancing loops → leverage points → recommendations",
   when:"Complex organisational and social problems. When solutions create new problems.",
   whenNot:"Fast tactical decisions. Simple product tasks.",
   uncertainty:"Systemic",
   output:"System map (CLD) + identified loops + intervention recommendations",
   limits:"Slow. Maps quickly become complex. Hard to translate into action plan.",
   tags:["systems","loops","meadows","forrester"]},

  {name:"Wardley Mapping",       g:8,col:0,row:5,meta:true,
   desc:"Components by evolution and visibility axis. Strategic moves in the market. Navigates strategy.",
   mechanism:"Identify need → decompose chain → place on evolution map → find moves",
   when:"Strategic decisions. Technology strategy. Competitive analysis.",
   whenNot:"Tactical and operational tasks.",
   uncertainty:"Strategic",
   output:"Wardley Map + strategic insights on build/buy/partner",
   limits:"Learning curve. Subjectivity in placement. Few practitioners.",
   tags:["strategy","evolution","wardley"]},

  {name:"Three Horizons",        g:8,col:0,row:5,meta:true,
   desc:"H1 (current) / H2 (transitional) / H3 (desired). Holding three horizons simultaneously. Navigates strategy over time.",
   mechanism:"Describe H1 → envision H3 → find seeds of H3 → design H2 transition",
   when:"Corporate strategy. Innovation portfolios. Foresight.",
   whenNot:"Operational tasks. Short horizon.",
   uncertainty:"Systemic / values-based",
   output:"Three horizons map + initiative portfolio",
   limits:"Blurriness between horizons. Does not provide operational plan.",
   tags:["foresight","strategy","three horizons"]},

  {name:"Speculative Design",    g:8,col:1,row:5,meta:true,
   desc:"Design of questions about the future — not solutions. Artifacts for dialogue. Critique through form.",
   mechanism:"Choose contradiction → design a 'possible world' → create artifact → dialogue",
   when:"Foresight sessions. Research projects. Ethical debates around technologies.",
   whenNot:"Concrete product tasks. When solutions are needed, not questions.",
   uncertainty:"Values-based / systemic",
   output:"Provocative artifacts + discussion + values reassessment",
   limits:"Does not provide solutions. Works only if the audience is ready for dialogue.",
   tags:["futures","critical","dunne","raby","RCA"]},

  {name:"Transition Design",     g:8,col:2,row:4,
   desc:"Systemic transitions to sustainable patterns. Wicked problems: climate, inequality, healthcare. 20–50 year horizon.",
   mechanism:"Map system → vision → leverage points → transition pathways → interventions",
   when:"Complex social and environmental problems. Policy design. Decade-scale horizon.",
   whenNot:"Commercial product tasks. Short projects.",
   uncertainty:"Systemic / values-based",
   output:"System maps + vision + transition pathways + interventions",
   limits:"Very slow. No success metric in the short term. Few practitioners.",
   tags:["transition","systemic","wicked","CMU","terry irwin"]},
];

// ── VOID CELL TYPES ──────────────────────────────────────────────────────────
const VOID_MAP = {
  '2-0': {type:'structural', label:'structural'},
  '3-0': {type:'structural', label:'structural'},
  '2-1': {type:'structural', label:'structural'},
  '3-1': {type:'structural', label:'structural'},
  '1-0': {type:'structural', label:'structural'},
  '0-6': {type:'historical', label:'historical gap'},
  '1-6': {type:'historical', label:'historical gap'},
  '3-6': {type:'historical', label:'historical gap'},
  '3-2': {type:'historical', label:'historical gap'},
  '2-3': {type:'historical', label:'historical gap'},
  '1-2': {type:'historical', label:'historical gap'},
  '1-4': {type:'outofscope', label:'out of scope'},
  '2-5': {type:'outofscope', label:'out of scope'},
  '3-5': {type:'outofscope', label:'out of scope'},
  '1-3': {type:'outofscope', label:'out of scope'},
};

function getVoidType(col, row){ return VOID_MAP[col+'-'+row] || null; }

const CDPA_ZONES=[[2,2],[2,3],[2,4],[2,6],[3,2],[3,4]];
function isCdpa(col,row){return CDPA_ZONES.some(([c,r])=>c===col&&r===row);}

// ── BUILD LEGEND ─────────────────────────────────────────────────────────────
const legendEl=document.getElementById('legend');
GROUPS.forEach(g=>{
  const el=document.createElement('button');
  el.type='button';
  el.className='legend-item';
  el.dataset.group=g.id;
  el.setAttribute('aria-pressed','true'); // all active by default
  const tipHtml = g.tip
    ? `<div class="legend-tip" role="tooltip"><b>${g.label}</b>${g.tip}</div>`
    : '';
  el.innerHTML=`<div class="legend-dot${g.pf?' pf':''}" style="${g.pf?'':'background:'+g.color}" aria-hidden="true"></div><span>${g.label}</span>${tipHtml}`;
  el.addEventListener('click',()=>toggleGroup(g.id));
  legendEl.appendChild(el);
});

const activeGroups=new Set(GROUPS.map(g=>g.id));

// ── BUILD GRID ────────────────────────────────────────────────────────────────
function buildGrid(){
  const grid=document.getElementById('map-grid');
  grid.innerHTML='';
  ROWS.forEach((rowDef,rowIdx)=>{
    const isLast=rowIdx===ROWS.length-1;
    const rl=document.createElement('div');
    rl.className='row-label'+(rowDef.arch?' arch-row':'')+(isLast?' last-row':'');
    rl.textContent=rowDef.label;
    rl.setAttribute('role','rowheader');
    grid.appendChild(rl);
    for(let col=0;col<4;col++){
      const cell=document.createElement('div');
      cell.className='cell'
        +(col===3?' last-col':'')
        +(isLast?' last-row':'')
        +(rowDef.arch?' arch-row-cell':'')
        +(isCdpa(col,rowIdx)?' cdpa-zone':'');
      cell.setAttribute('role','gridcell');
      cell.setAttribute('aria-label', ROWS[rowIdx].label+' × '+['Diagnosis','Generation','Resolution','Optimisation'][col]);
      const methods=METHODS.filter(m=>m.col===col&&m.row===rowIdx);
      methods.forEach(m=>{
        const chip=document.createElement('button');
        chip.type='button';
        chip.className='chip'+(m.pf?' pf-chip':'')+(m.star?' star':'');
        chip.dataset.name=m.name;
        chip.dataset.group=m.g;
        chip.setAttribute('aria-pressed','false');
        // disable if group not active
        if(!activeGroups.has(m.g)){
          chip.setAttribute('aria-disabled','true');
          chip.tabIndex=-1;
        }
        const gc=GROUPS.find(g=>g.id===m.g).color;
        if(m.pf){
          chip.style.borderColor=rgba(gc,.42);
          chip.style.color=lighten(gc,48);
        } else {
          chip.style.background=rgba(gc,m.star?.28:.15);
          chip.style.border=`1px solid ${rgba(gc,m.star?.68:.36)}`;
          chip.style.color=lighten(gc,m.star?72:52);
        }
        if(m.meta){
          const mark=document.createElement('span');
          mark.className='meta-marker';
          mark.setAttribute('aria-hidden','true');
          mark.textContent='◆';
          mark.style.color=lighten(gc,30);
          chip.appendChild(mark);
          chip.appendChild(document.createTextNode(m.name));
          chip.setAttribute('aria-label', m.name+' (meta-method)');
        } else {
          chip.textContent=m.name;
        }
        chip.addEventListener('click',e=>{e.stopPropagation();openPanel(m,chip);});
        cell.appendChild(chip);
      });
      if(methods.length===0){
        const vt=getVoidType(col,rowIdx);
        if(vt){
          cell.classList.add('void-'+vt.type);
          const gl=document.createElement('div');
          gl.className='gap-label gap-'+vt.type;
          gl.setAttribute('aria-label', vt.label);
          const dot=document.createElement('div');
          dot.className='gap-dot';
          dot.setAttribute('aria-hidden','true');
          const nullSym=document.createElement('span');
          nullSym.setAttribute('aria-hidden','true');
          nullSym.textContent='∅ ';
          const txt=document.createElement('span');
          txt.className='gap-text';
          txt.textContent=vt.label;
          gl.appendChild(dot);
          gl.appendChild(nullSym);
          gl.appendChild(txt);
          cell.appendChild(gl);
        }
      }
      grid.appendChild(cell);
    }
  });
}

// ── PANEL ─────────────────────────────────────────────────────────────────────
let lastFocusedChip=null;
const panel=document.getElementById('panel');

function openPanel(m, chipEl){
  // deactivate previous
  document.querySelectorAll('.chip[aria-pressed="true"]').forEach(c=>{
    c.setAttribute('aria-pressed','false');
  });
  if(chipEl){
    chipEl.setAttribute('aria-pressed','true');
    lastFocusedChip=chipEl;
  }

  const g=GROUPS.find(x=>x.id===m.g);
  const gc=g.color;

  document.getElementById('p-group').textContent=g.label;
  document.getElementById('p-group').style.color=lighten(gc,40);
  document.getElementById('p-name').textContent=m.name;

  // chips
  const chipsEl=document.getElementById('p-chips');
  chipsEl.innerHTML='';
  (m.tags||[]).forEach(t=>{
    const s=document.createElement('span');
    s.className='panel-chip';
    s.textContent=t;
    chipsEl.appendChild(s);
  });
  if(m.cdpa){
    const s=document.createElement('span');
    s.className='panel-chip cdpa';
    s.textContent='cdpa zone';
    chipsEl.appendChild(s);
  }
  if(m.pf){
    const s=document.createElement('span');
    s.className='panel-chip pf';
    s.textContent='process framework';
    chipsEl.appendChild(s);
  }
  if(m.meta){
    const s=document.createElement('span');
    s.className='panel-chip meta';
    s.textContent='◆ meta-method';
    chipsEl.appendChild(s);
  }

  // body
  const body=document.getElementById('p-body');
  body.innerHTML='';

  const sections=[
    {label:'Description',    content:m.desc,       highlight:false},
    {label:'Mechanism',      content:m.mechanism,  highlight:true},
    {label:'When to use',    content:m.when},
    {label:'When NOT to use',content:m.whenNot},
    {label:'Uncertainty type',content:m.uncertainty},
    {label:'Output',         content:m.output},
    {label:'Limitations',    content:m.limits},
  ];

  sections.forEach(s=>{
    if(!s.content) return;
    const sec=document.createElement('div');
    sec.className='panel-section';
    const lbl=document.createElement('div');
    lbl.className='panel-section-label';
    lbl.textContent=s.label;
    const cnt=document.createElement('div');
    cnt.className='panel-section-content'+(s.highlight?' highlight':'');
    if(s.highlight) cnt.style.borderLeftColor=lighten(gc,20);
    cnt.textContent=s.content;
    sec.appendChild(lbl);
    sec.appendChild(cnt);
    body.appendChild(sec);
  });

  panel.classList.add('open');
  panel.setAttribute('aria-hidden','false');

  // Move focus to close button
  requestAnimationFrame(()=>{
    document.getElementById('panel-close').focus();
  });
}

function closePanel(){
  panel.classList.remove('open');
  panel.setAttribute('aria-hidden','true');
  document.querySelectorAll('.chip[aria-pressed="true"]').forEach(c=>{
    c.setAttribute('aria-pressed','false');
  });
  // Return focus to the chip that opened the panel
  if(lastFocusedChip){
    lastFocusedChip.focus();
    lastFocusedChip=null;
  }
}

document.getElementById('panel-close').addEventListener('click',closePanel);
document.addEventListener('keydown',e=>{
  if(e.key==='Escape') closePanel();
});
document.getElementById('map-grid').addEventListener('click',e=>{
  if(!e.target.closest('.chip')) closePanel();
});

// ── FILTERS ───────────────────────────────────────────────────────────────────
function toggleGroup(gid){
  if(activeGroups.has(gid)) activeGroups.delete(gid);
  else activeGroups.add(gid);
  // update legend button aria-pressed
  document.querySelectorAll('.legend-item').forEach(el=>{
    const id=parseInt(el.dataset.group);
    el.setAttribute('aria-pressed', activeGroups.has(id) ? 'true' : 'false');
  });
  applyDim(null);
}

function applyDim(fn){
  document.querySelectorAll('.chip').forEach(chip=>{
    const name=chip.dataset.name;
    const m=METHODS.find(x=>x.name===name);
    const ok=fn?fn(m):activeGroups.has(m.g);
    if(ok){
      chip.removeAttribute('aria-disabled');
      chip.tabIndex=0;
    } else {
      chip.setAttribute('aria-disabled','true');
      chip.tabIndex=-1;
    }
  });
}

document.querySelectorAll('.filter-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.filter-btn').forEach(b=>b.setAttribute('aria-pressed','false'));
    btn.setAttribute('aria-pressed','true');
    const f=btn.dataset.filter;
    if(f==='all')  applyDim(null);
    if(f==='cdpa') applyDim(m=>m.cdpa);
    if(f==='gap')  applyDim(m=>m.cdpa);
    if(f==='nopf') applyDim(m=>!m.pf);
  });
});

// ── UTILS ──────────────────────────────────────────────────────────────────────
function rgba(hex,a){const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);return `rgba(${r},${g},${b},${a})`;}
function lighten(hex,a){return `rgb(${Math.min(255,parseInt(hex.slice(1,3),16)+a)},${Math.min(255,parseInt(hex.slice(3,5),16)+a)},${Math.min(255,parseInt(hex.slice(5,7),16)+a)})`;}

buildGrid();
</script>
</body>
</html>
